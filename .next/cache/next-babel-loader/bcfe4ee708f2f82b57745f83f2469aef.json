{"ast":null,"code":"import _regeneratorRuntime from \"@babel/runtime-corejs2/regenerator\";\nimport _JSXStyle from \"styled-jsx/style\";\nimport React from \"react\";\nvar __jsx = React.createElement;\nimport fetch from 'isomorphic-unfetch';\nimport { useState } from 'react';\nimport { useStoreActions, useStoreState } from 'easy-peasy';\nimport axios from 'axios';\nimport Head from 'next/head';\nimport Layout from '../../components/Layout';\nimport DateRangePicker from '../../components/DateRangePicker';\n\nvar calcNumberOfNightsBetweenDates = function calcNumberOfNightsBetweenDates(startDate, endDate) {\n  var start = new Date(startDate);\n  var end = new Date(endDate);\n  var dayCount = 0;\n\n  while (end > start) {\n    dayCount++;\n    start.setDate(start.getDate() + 1);\n  }\n\n  return dayCount;\n};\n\nvar getBookedDates = function getBookedDates(houseId) {\n  var response;\n  return _regeneratorRuntime.async(function getBookedDates$(_context) {\n    while (1) {\n      switch (_context.prev = _context.next) {\n        case 0:\n          _context.prev = 0;\n          _context.next = 3;\n          return _regeneratorRuntime.awrap(axios.post('http://localhost:3000/api/houses/booked', {\n            houseId: houseId\n          }));\n\n        case 3:\n          response = _context.sent;\n\n          if (!(response.data.status === 'error')) {\n            _context.next = 7;\n            break;\n          }\n\n          alert(response.data.message);\n          return _context.abrupt(\"return\");\n\n        case 7:\n          return _context.abrupt(\"return\", response.data.dates);\n\n        case 10:\n          _context.prev = 10;\n          _context.t0 = _context[\"catch\"](0);\n          console.error(_context.t0);\n          return _context.abrupt(\"return\");\n\n        case 14:\n        case \"end\":\n          return _context.stop();\n      }\n    }\n  }, null, null, [[0, 10]]);\n};\n\nvar canReserve = function canReserve(houseId, startDate, endDate) {\n  var _houseId, response;\n\n  return _regeneratorRuntime.async(function canReserve$(_context2) {\n    while (1) {\n      switch (_context2.prev = _context2.next) {\n        case 0:\n          _context2.prev = 0;\n          _houseId = house.id;\n          _context2.next = 4;\n          return _regeneratorRuntime.awrap(axios.post('http://localhost:3000/api/houses/check', {\n            houseId: _houseId,\n            startDate: startDate,\n            endDate: endDate\n          }));\n\n        case 4:\n          response = _context2.sent;\n\n          if (!(response.data.status === 'error')) {\n            _context2.next = 8;\n            break;\n          }\n\n          alert(response.data.message);\n          return _context2.abrupt(\"return\");\n\n        case 8:\n          if (!(response.data.message === 'busy')) {\n            _context2.next = 10;\n            break;\n          }\n\n          return _context2.abrupt(\"return\", false);\n\n        case 10:\n          return _context2.abrupt(\"return\", true);\n\n        case 13:\n          _context2.prev = 13;\n          _context2.t0 = _context2[\"catch\"](0);\n          console.error(_context2.t0);\n          return _context2.abrupt(\"return\");\n\n        case 17:\n        case \"end\":\n          return _context2.stop();\n      }\n    }\n  }, null, null, [[0, 13]]);\n};\n\nvar House = function House(props) {\n  var _useState = useState(0),\n      numberOfNightsBetweenDates = _useState[0],\n      setNumberOfNightsBetweenDates = _useState[1];\n\n  var _useState2 = useState(false),\n      dateChosen = _useState2[0],\n      setDateChosen = _useState2[1];\n\n  var _useState3 = useState(),\n      startDate = _useState3[0],\n      setStartDate = _useState3[1];\n\n  var _useState4 = useState(),\n      endDate = _useState4[0],\n      setEndDate = _useState4[1];\n\n  var setShowLoginModal = useStoreActions(function (actions) {\n    return actions.modals.setShowLoginModal;\n  });\n  var user = useStoreState(function (state) {\n    return state.user.user;\n  });\n  return __jsx(Layout, {\n    content: __jsx(\"div\", {\n      className: \"jsx-1671841858\" + \" \" + 'container'\n    }, __jsx(Head, null, __jsx(\"title\", {\n      className: \"jsx-1671841858\"\n    }, props.house.title)), __jsx(\"article\", {\n      className: \"jsx-1671841858\"\n    }, __jsx(\"h1\", {\n      className: \"jsx-1671841858\"\n    }, \"Welcome to \", props.house.hostName || 'no name', \"'s listing\"), __jsx(\"img\", {\n      src: props.house.picture,\n      width: \"100%\",\n      alt: \"House picture\",\n      className: \"jsx-1671841858\"\n    }), __jsx(\"p\", {\n      className: \"jsx-1671841858\"\n    }, props.house.type, \" - \", props.house.town), __jsx(\"p\", {\n      className: \"jsx-1671841858\"\n    }, props.house.title), props.house.reviewsCount ? __jsx(\"div\", {\n      className: \"jsx-1671841858\" + \" \" + 'reviews'\n    }, __jsx(\"h3\", {\n      className: \"jsx-1671841858\"\n    }, props.house.reviewsCount, \" Reviews \"), props.house.reviews.map(function (review, index) {\n      return __jsx(\"div\", {\n        key: index,\n        className: \"jsx-1671841858\"\n      }, __jsx(\"p\", {\n        className: \"jsx-1671841858\"\n      }, new Date(review.createdAt).toDateString()), __jsx(\"p\", {\n        className: \"jsx-1671841858\"\n      }, review.comment));\n    })) : __jsx(React.Fragment, null)), __jsx(\"aside\", {\n      className: \"jsx-1671841858\"\n    }, __jsx(\"h2\", {\n      className: \"jsx-1671841858\"\n    }, \"Add dates for prices\"), __jsx(DateRangePicker, {\n      datesChanged: function datesChanged(startDate, endDate) {\n        setNumberOfNightsBetweenDates(calcNumberOfNightsBetweenDates(startDate, endDate));\n        setDateChosen(true);\n        setStartDate(startDate);\n        setEndDate(endDate);\n      },\n      bookedDates: props.bookedDates\n    }), dateChosen && __jsx(\"div\", {\n      className: \"jsx-1671841858\"\n    }, __jsx(\"h2\", {\n      className: \"jsx-1671841858\"\n    }, \"Price per night\"), __jsx(\"p\", {\n      className: \"jsx-1671841858\"\n    }, \"$\", props.house.price), __jsx(\"h2\", {\n      className: \"jsx-1671841858\"\n    }, \"Total price for booking\"), __jsx(\"p\", {\n      className: \"jsx-1671841858\"\n    }, \"$\", (numberOfNightsBetweenDates * props.house.price).toFixed(2)), user ? __jsx(\"button\", {\n      onClick: function _callee() {\n        var response;\n        return _regeneratorRuntime.async(function _callee$(_context3) {\n          while (1) {\n            switch (_context3.prev = _context3.next) {\n              case 0:\n                _context3.next = 2;\n                return _regeneratorRuntime.awrap(canReserve(props.house.id, startDate, endDate));\n\n              case 2:\n                if (_context3.sent) {\n                  _context3.next = 5;\n                  break;\n                }\n\n                alert('The dates chosen are not valid');\n                return _context3.abrupt(\"return\");\n\n              case 5:\n                _context3.prev = 5;\n                _context3.next = 8;\n                return _regeneratorRuntime.awrap(axios.post('/api/houses/reserve', {\n                  houseId: props.house.id,\n                  startDate: startDate,\n                  endDate: endDate\n                }));\n\n              case 8:\n                response = _context3.sent;\n\n                if (!(response.data.status === 'error')) {\n                  _context3.next = 12;\n                  break;\n                }\n\n                alert(response.data.message);\n                return _context3.abrupt(\"return\");\n\n              case 12:\n                console.log(response.data);\n                _context3.next = 19;\n                break;\n\n              case 15:\n                _context3.prev = 15;\n                _context3.t0 = _context3[\"catch\"](5);\n                console.log(_context3.t0);\n                return _context3.abrupt(\"return\");\n\n              case 19:\n              case \"end\":\n                return _context3.stop();\n            }\n          }\n        }, null, null, [[5, 15]]);\n      },\n      className: \"jsx-1671841858\" + \" \" + 'reserve'\n    }, \"Reserve\") : __jsx(\"button\", {\n      onClick: function onClick() {\n        setShowLoginModal();\n      },\n      className: \"jsx-1671841858\" + \" \" + 'reserve'\n    }, \"Reserve\"))), __jsx(_JSXStyle, {\n      id: \"1671841858\"\n    }, \".container.jsx-1671841858{display:grid;grid-template-columns:60% 40%;grid-gap:30px;}aside.jsx-1671841858{border:1px solid #ccc;padding:20px;}\\n/*# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi9Vc2Vycy9iZW5ueXdhbmcvRG9jdW1lbnRzL1Byb2plY3RzL2dhbWVkbmQvcGFnZXMvaG91c2VzL1tpZF0uanMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IkFBZ0xzQixBQUc0QixBQU1TLGFBTFEsU0FNakIsYUFDZixRQU5nQixjQUNoQiIsImZpbGUiOiIvVXNlcnMvYmVubnl3YW5nL0RvY3VtZW50cy9Qcm9qZWN0cy9nYW1lZG5kL3BhZ2VzL2hvdXNlcy9baWRdLmpzIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IGZldGNoIGZyb20gJ2lzb21vcnBoaWMtdW5mZXRjaCc7XG5pbXBvcnQgeyB1c2VTdGF0ZSB9IGZyb20gJ3JlYWN0JztcbmltcG9ydCB7IHVzZVN0b3JlQWN0aW9ucywgdXNlU3RvcmVTdGF0ZSB9IGZyb20gJ2Vhc3ktcGVhc3knO1xuaW1wb3J0IGF4aW9zIGZyb20gJ2F4aW9zJztcblxuaW1wb3J0IEhlYWQgZnJvbSAnbmV4dC9oZWFkJztcbmltcG9ydCBMYXlvdXQgZnJvbSAnLi4vLi4vY29tcG9uZW50cy9MYXlvdXQnO1xuaW1wb3J0IERhdGVSYW5nZVBpY2tlciBmcm9tICcuLi8uLi9jb21wb25lbnRzL0RhdGVSYW5nZVBpY2tlcic7XG5cbmNvbnN0IGNhbGNOdW1iZXJPZk5pZ2h0c0JldHdlZW5EYXRlcyA9IChzdGFydERhdGUsIGVuZERhdGUpID0+IHtcbiAgY29uc3Qgc3RhcnQgPSBuZXcgRGF0ZShzdGFydERhdGUpO1xuICBjb25zdCBlbmQgPSBuZXcgRGF0ZShlbmREYXRlKTtcbiAgbGV0IGRheUNvdW50ID0gMDtcblxuICB3aGlsZSAoZW5kID4gc3RhcnQpIHtcbiAgICBkYXlDb3VudCsrO1xuICAgIHN0YXJ0LnNldERhdGUoc3RhcnQuZ2V0RGF0ZSgpICsgMSk7XG4gIH1cbiAgcmV0dXJuIGRheUNvdW50O1xufTtcblxuY29uc3QgZ2V0Qm9va2VkRGF0ZXMgPSBhc3luYyBob3VzZUlkID0+IHtcbiAgdHJ5IHtcbiAgICBjb25zdCByZXNwb25zZSA9IGF3YWl0IGF4aW9zLnBvc3QoXG4gICAgICAnaHR0cDovL2xvY2FsaG9zdDozMDAwL2FwaS9ob3VzZXMvYm9va2VkJyxcbiAgICAgIHtcbiAgICAgICAgaG91c2VJZFxuICAgICAgfVxuICAgICk7XG4gICAgaWYgKHJlc3BvbnNlLmRhdGEuc3RhdHVzID09PSAnZXJyb3InKSB7XG4gICAgICBhbGVydChyZXNwb25zZS5kYXRhLm1lc3NhZ2UpO1xuICAgICAgcmV0dXJuO1xuICAgIH1cbiAgICByZXR1cm4gcmVzcG9uc2UuZGF0YS5kYXRlcztcbiAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICBjb25zb2xlLmVycm9yKGVycm9yKTtcbiAgICByZXR1cm47XG4gIH1cbn07XG5cbmNvbnN0IGNhblJlc2VydmUgPSBhc3luYyAoaG91c2VJZCwgc3RhcnREYXRlLCBlbmREYXRlKSA9PiB7XG4gIHRyeSB7XG4gICAgY29uc3QgaG91c2VJZCA9IGhvdXNlLmlkO1xuICAgIGNvbnN0IHJlc3BvbnNlID0gYXdhaXQgYXhpb3MucG9zdChcbiAgICAgICdodHRwOi8vbG9jYWxob3N0OjMwMDAvYXBpL2hvdXNlcy9jaGVjaycsXG4gICAgICB7XG4gICAgICAgIGhvdXNlSWQsXG4gICAgICAgIHN0YXJ0RGF0ZSxcbiAgICAgICAgZW5kRGF0ZVxuICAgICAgfVxuICAgICk7XG4gICAgaWYgKHJlc3BvbnNlLmRhdGEuc3RhdHVzID09PSAnZXJyb3InKSB7XG4gICAgICBhbGVydChyZXNwb25zZS5kYXRhLm1lc3NhZ2UpO1xuICAgICAgcmV0dXJuO1xuICAgIH1cbiAgICBpZiAocmVzcG9uc2UuZGF0YS5tZXNzYWdlID09PSAnYnVzeScpIHtcbiAgICAgIHJldHVybiBmYWxzZTtcbiAgICB9XG4gICAgcmV0dXJuIHRydWU7XG4gIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgY29uc29sZS5lcnJvcihlcnJvcik7XG4gICAgcmV0dXJuO1xuICB9XG59O1xuXG5jb25zdCBIb3VzZSA9IHByb3BzID0+IHtcbiAgY29uc3QgW251bWJlck9mTmlnaHRzQmV0d2VlbkRhdGVzLCBzZXROdW1iZXJPZk5pZ2h0c0JldHdlZW5EYXRlc10gPSB1c2VTdGF0ZShcbiAgICAwXG4gICk7XG4gIGNvbnN0IFtkYXRlQ2hvc2VuLCBzZXREYXRlQ2hvc2VuXSA9IHVzZVN0YXRlKGZhbHNlKTtcbiAgY29uc3QgW3N0YXJ0RGF0ZSwgc2V0U3RhcnREYXRlXSA9IHVzZVN0YXRlKCk7XG4gIGNvbnN0IFtlbmREYXRlLCBzZXRFbmREYXRlXSA9IHVzZVN0YXRlKCk7XG5cbiAgY29uc3Qgc2V0U2hvd0xvZ2luTW9kYWwgPSB1c2VTdG9yZUFjdGlvbnMoXG4gICAgYWN0aW9ucyA9PiBhY3Rpb25zLm1vZGFscy5zZXRTaG93TG9naW5Nb2RhbFxuICApO1xuXG4gIGNvbnN0IHVzZXIgPSB1c2VTdG9yZVN0YXRlKHN0YXRlID0+IHN0YXRlLnVzZXIudXNlcik7XG5cbiAgcmV0dXJuIChcbiAgICA8TGF5b3V0XG4gICAgICBjb250ZW50PXtcbiAgICAgICAgPGRpdiBjbGFzc05hbWU9J2NvbnRhaW5lcic+XG4gICAgICAgICAgPEhlYWQ+XG4gICAgICAgICAgICA8dGl0bGU+e3Byb3BzLmhvdXNlLnRpdGxlfTwvdGl0bGU+XG4gICAgICAgICAgPC9IZWFkPlxuICAgICAgICAgIDxhcnRpY2xlPlxuICAgICAgICAgICAgPGgxPldlbGNvbWUgdG8ge3Byb3BzLmhvdXNlLmhvc3ROYW1lIHx8ICdubyBuYW1lJ30ncyBsaXN0aW5nPC9oMT5cbiAgICAgICAgICAgIDxpbWcgc3JjPXtwcm9wcy5ob3VzZS5waWN0dXJlfSB3aWR0aD0nMTAwJScgYWx0PSdIb3VzZSBwaWN0dXJlJyAvPlxuICAgICAgICAgICAgPHA+XG4gICAgICAgICAgICAgIHtwcm9wcy5ob3VzZS50eXBlfSAtIHtwcm9wcy5ob3VzZS50b3dufVxuICAgICAgICAgICAgPC9wPlxuICAgICAgICAgICAgPHA+e3Byb3BzLmhvdXNlLnRpdGxlfTwvcD5cblxuICAgICAgICAgICAge3Byb3BzLmhvdXNlLnJldmlld3NDb3VudCA/IChcbiAgICAgICAgICAgICAgPGRpdiBjbGFzc05hbWU9J3Jldmlld3MnPlxuICAgICAgICAgICAgICAgIDxoMz57cHJvcHMuaG91c2UucmV2aWV3c0NvdW50fSBSZXZpZXdzIDwvaDM+XG5cbiAgICAgICAgICAgICAgICB7cHJvcHMuaG91c2UucmV2aWV3cy5tYXAoKHJldmlldywgaW5kZXgpID0+IHtcbiAgICAgICAgICAgICAgICAgIHJldHVybiAoXG4gICAgICAgICAgICAgICAgICAgIDxkaXYga2V5PXtpbmRleH0+XG4gICAgICAgICAgICAgICAgICAgICAgPHA+e25ldyBEYXRlKHJldmlldy5jcmVhdGVkQXQpLnRvRGF0ZVN0cmluZygpfTwvcD5cbiAgICAgICAgICAgICAgICAgICAgICA8cD57cmV2aWV3LmNvbW1lbnR9PC9wPlxuICAgICAgICAgICAgICAgICAgICA8L2Rpdj5cbiAgICAgICAgICAgICAgICAgICk7XG4gICAgICAgICAgICAgICAgfSl9XG4gICAgICAgICAgICAgIDwvZGl2PlxuICAgICAgICAgICAgKSA6IChcbiAgICAgICAgICAgICAgPD48Lz5cbiAgICAgICAgICAgICl9XG4gICAgICAgICAgPC9hcnRpY2xlPlxuICAgICAgICAgIDxhc2lkZT5cbiAgICAgICAgICAgIDxoMj5BZGQgZGF0ZXMgZm9yIHByaWNlczwvaDI+XG4gICAgICAgICAgICA8RGF0ZVJhbmdlUGlja2VyXG4gICAgICAgICAgICAgIGRhdGVzQ2hhbmdlZD17KHN0YXJ0RGF0ZSwgZW5kRGF0ZSkgPT4ge1xuICAgICAgICAgICAgICAgIHNldE51bWJlck9mTmlnaHRzQmV0d2VlbkRhdGVzKFxuICAgICAgICAgICAgICAgICAgY2FsY051bWJlck9mTmlnaHRzQmV0d2VlbkRhdGVzKHN0YXJ0RGF0ZSwgZW5kRGF0ZSlcbiAgICAgICAgICAgICAgICApO1xuICAgICAgICAgICAgICAgIHNldERhdGVDaG9zZW4odHJ1ZSk7XG4gICAgICAgICAgICAgICAgc2V0U3RhcnREYXRlKHN0YXJ0RGF0ZSk7XG4gICAgICAgICAgICAgICAgc2V0RW5kRGF0ZShlbmREYXRlKTtcbiAgICAgICAgICAgICAgfX1cbiAgICAgICAgICAgICAgYm9va2VkRGF0ZXM9e3Byb3BzLmJvb2tlZERhdGVzfVxuICAgICAgICAgICAgLz5cbiAgICAgICAgICAgIHtkYXRlQ2hvc2VuICYmIChcbiAgICAgICAgICAgICAgPGRpdj5cbiAgICAgICAgICAgICAgICA8aDI+UHJpY2UgcGVyIG5pZ2h0PC9oMj5cbiAgICAgICAgICAgICAgICA8cD4ke3Byb3BzLmhvdXNlLnByaWNlfTwvcD5cbiAgICAgICAgICAgICAgICA8aDI+VG90YWwgcHJpY2UgZm9yIGJvb2tpbmc8L2gyPlxuICAgICAgICAgICAgICAgIDxwPlxuICAgICAgICAgICAgICAgICAgJHsobnVtYmVyT2ZOaWdodHNCZXR3ZWVuRGF0ZXMgKiBwcm9wcy5ob3VzZS5wcmljZSkudG9GaXhlZCgyKX1cbiAgICAgICAgICAgICAgICA8L3A+XG5cbiAgICAgICAgICAgICAgICB7dXNlciA/IChcbiAgICAgICAgICAgICAgICAgIDxidXR0b25cbiAgICAgICAgICAgICAgICAgICAgY2xhc3NOYW1lPSdyZXNlcnZlJ1xuICAgICAgICAgICAgICAgICAgICBvbkNsaWNrPXthc3luYyAoKSA9PiB7XG4gICAgICAgICAgICAgICAgICAgICAgaWYgKFxuICAgICAgICAgICAgICAgICAgICAgICAgIShhd2FpdCBjYW5SZXNlcnZlKHByb3BzLmhvdXNlLmlkLCBzdGFydERhdGUsIGVuZERhdGUpKVxuICAgICAgICAgICAgICAgICAgICAgICkge1xuICAgICAgICAgICAgICAgICAgICAgICAgYWxlcnQoJ1RoZSBkYXRlcyBjaG9zZW4gYXJlIG5vdCB2YWxpZCcpO1xuICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgICB0cnkge1xuICAgICAgICAgICAgICAgICAgICAgICAgY29uc3QgcmVzcG9uc2UgPSBhd2FpdCBheGlvcy5wb3N0KFxuICAgICAgICAgICAgICAgICAgICAgICAgICAnL2FwaS9ob3VzZXMvcmVzZXJ2ZScsXG4gICAgICAgICAgICAgICAgICAgICAgICAgIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBob3VzZUlkOiBwcm9wcy5ob3VzZS5pZCxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBzdGFydERhdGUsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgZW5kRGF0ZVxuICAgICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgICAgICApO1xuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHJlc3BvbnNlLmRhdGEuc3RhdHVzID09PSAnZXJyb3InKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgIGFsZXJ0KHJlc3BvbnNlLmRhdGEubWVzc2FnZSk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgICAgIGNvbnNvbGUubG9nKHJlc3BvbnNlLmRhdGEpO1xuICAgICAgICAgICAgICAgICAgICAgIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBjb25zb2xlLmxvZyhlcnJvcik7XG4gICAgICAgICAgICAgICAgICAgICAgICByZXR1cm47XG4gICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICB9fT5cbiAgICAgICAgICAgICAgICAgICAgUmVzZXJ2ZVxuICAgICAgICAgICAgICAgICAgPC9idXR0b24+XG4gICAgICAgICAgICAgICAgKSA6IChcbiAgICAgICAgICAgICAgICAgIDxidXR0b25cbiAgICAgICAgICAgICAgICAgICAgY2xhc3NOYW1lPSdyZXNlcnZlJ1xuICAgICAgICAgICAgICAgICAgICBvbkNsaWNrPXsoKSA9PiB7XG4gICAgICAgICAgICAgICAgICAgICAgc2V0U2hvd0xvZ2luTW9kYWwoKTtcbiAgICAgICAgICAgICAgICAgICAgfX0+XG4gICAgICAgICAgICAgICAgICAgIFJlc2VydmVcbiAgICAgICAgICAgICAgICAgIDwvYnV0dG9uPlxuICAgICAgICAgICAgICAgICl9XG4gICAgICAgICAgICAgIDwvZGl2PlxuICAgICAgICAgICAgKX1cbiAgICAgICAgICA8L2FzaWRlPlxuICAgICAgICAgIDxzdHlsZSBqc3g+e2BcbiAgICAgICAgICAgIC5jb250YWluZXIge1xuICAgICAgICAgICAgICBkaXNwbGF5OiBncmlkO1xuICAgICAgICAgICAgICBncmlkLXRlbXBsYXRlLWNvbHVtbnM6IDYwJSA0MCU7XG4gICAgICAgICAgICAgIGdyaWQtZ2FwOiAzMHB4O1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICBhc2lkZSB7XG4gICAgICAgICAgICAgIGJvcmRlcjogMXB4IHNvbGlkICNjY2M7XG4gICAgICAgICAgICAgIHBhZGRpbmc6IDIwcHg7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgYH08L3N0eWxlPlxuICAgICAgICA8L2Rpdj5cbiAgICAgIH1cbiAgICAvPlxuICApO1xufTtcblxuSG91c2UuZ2V0SW5pdGlhbFByb3BzID0gYXN5bmMgKHsgcXVlcnkgfSkgPT4ge1xuICBjb25zdCB7IGlkIH0gPSBxdWVyeTtcblxuICBjb25zdCByZXMgPSBhd2FpdCBmZXRjaChgaHR0cDovL2xvY2FsaG9zdDozMDAwL2FwaS9ob3VzZXMvJHtpZH1gKTtcbiAgY29uc3QgaG91c2UgPSBhd2FpdCByZXMuanNvbigpO1xuXG4gIGNvbnN0IGJvb2tlZERhdGVzID0gYXdhaXQgZ2V0Qm9va2VkRGF0ZXMoaWQpO1xuICByZXR1cm4ge1xuICAgIGhvdXNlLFxuICAgIGJvb2tlZERhdGVzXG4gIH07XG59O1xuXG5leHBvcnQgZGVmYXVsdCBIb3VzZTtcbiJdfQ== */\\n/*@ sourceURL=/Users/bennywang/Documents/Projects/gamednd/pages/houses/[id].js */\"))\n  });\n};\n\nHouse.getInitialProps = function _callee2(_ref) {\n  var query, id, res, house, bookedDates;\n  return _regeneratorRuntime.async(function _callee2$(_context4) {\n    while (1) {\n      switch (_context4.prev = _context4.next) {\n        case 0:\n          query = _ref.query;\n          id = query.id;\n          _context4.next = 4;\n          return _regeneratorRuntime.awrap(fetch(\"http://localhost:3000/api/houses/\".concat(id)));\n\n        case 4:\n          res = _context4.sent;\n          _context4.next = 7;\n          return _regeneratorRuntime.awrap(res.json());\n\n        case 7:\n          house = _context4.sent;\n          _context4.next = 10;\n          return _regeneratorRuntime.awrap(getBookedDates(id));\n\n        case 10:\n          bookedDates = _context4.sent;\n          return _context4.abrupt(\"return\", {\n            house: house,\n            bookedDates: bookedDates\n          });\n\n        case 12:\n        case \"end\":\n          return _context4.stop();\n      }\n    }\n  });\n};\n\nexport default House;","map":{"version":3,"sources":["/Users/bennywang/Documents/Projects/gamednd/pages/houses/[id].js"],"names":["fetch","useState","useStoreActions","useStoreState","axios","Head","Layout","DateRangePicker","calcNumberOfNightsBetweenDates","startDate","endDate","start","Date","end","dayCount","setDate","getDate","getBookedDates","houseId","post","response","data","status","alert","message","dates","console","error","canReserve","house","id","House","props","numberOfNightsBetweenDates","setNumberOfNightsBetweenDates","dateChosen","setDateChosen","setStartDate","setEndDate","setShowLoginModal","actions","modals","user","state","title","hostName","picture","type","town","reviewsCount","reviews","map","review","index","createdAt","toDateString","comment","bookedDates","price","toFixed","log","getInitialProps","query","res","json"],"mappings":"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","sourcesContent":["import fetch from 'isomorphic-unfetch';\nimport { useState } from 'react';\nimport { useStoreActions, useStoreState } from 'easy-peasy';\nimport axios from 'axios';\n\nimport Head from 'next/head';\nimport Layout from '../../components/Layout';\nimport DateRangePicker from '../../components/DateRangePicker';\n\nconst calcNumberOfNightsBetweenDates = (startDate, endDate) => {\n  const start = new Date(startDate);\n  const end = new Date(endDate);\n  let dayCount = 0;\n\n  while (end > start) {\n    dayCount++;\n    start.setDate(start.getDate() + 1);\n  }\n  return dayCount;\n};\n\nconst getBookedDates = async houseId => {\n  try {\n    const response = await axios.post(\n      'http://localhost:3000/api/houses/booked',\n      {\n        houseId\n      }\n    );\n    if (response.data.status === 'error') {\n      alert(response.data.message);\n      return;\n    }\n    return response.data.dates;\n  } catch (error) {\n    console.error(error);\n    return;\n  }\n};\n\nconst canReserve = async (houseId, startDate, endDate) => {\n  try {\n    const houseId = house.id;\n    const response = await axios.post(\n      'http://localhost:3000/api/houses/check',\n      {\n        houseId,\n        startDate,\n        endDate\n      }\n    );\n    if (response.data.status === 'error') {\n      alert(response.data.message);\n      return;\n    }\n    if (response.data.message === 'busy') {\n      return false;\n    }\n    return true;\n  } catch (error) {\n    console.error(error);\n    return;\n  }\n};\n\nconst House = props => {\n  const [numberOfNightsBetweenDates, setNumberOfNightsBetweenDates] = useState(\n    0\n  );\n  const [dateChosen, setDateChosen] = useState(false);\n  const [startDate, setStartDate] = useState();\n  const [endDate, setEndDate] = useState();\n\n  const setShowLoginModal = useStoreActions(\n    actions => actions.modals.setShowLoginModal\n  );\n\n  const user = useStoreState(state => state.user.user);\n\n  return (\n    <Layout\n      content={\n        <div className='container'>\n          <Head>\n            <title>{props.house.title}</title>\n          </Head>\n          <article>\n            <h1>Welcome to {props.house.hostName || 'no name'}'s listing</h1>\n            <img src={props.house.picture} width='100%' alt='House picture' />\n            <p>\n              {props.house.type} - {props.house.town}\n            </p>\n            <p>{props.house.title}</p>\n\n            {props.house.reviewsCount ? (\n              <div className='reviews'>\n                <h3>{props.house.reviewsCount} Reviews </h3>\n\n                {props.house.reviews.map((review, index) => {\n                  return (\n                    <div key={index}>\n                      <p>{new Date(review.createdAt).toDateString()}</p>\n                      <p>{review.comment}</p>\n                    </div>\n                  );\n                })}\n              </div>\n            ) : (\n              <></>\n            )}\n          </article>\n          <aside>\n            <h2>Add dates for prices</h2>\n            <DateRangePicker\n              datesChanged={(startDate, endDate) => {\n                setNumberOfNightsBetweenDates(\n                  calcNumberOfNightsBetweenDates(startDate, endDate)\n                );\n                setDateChosen(true);\n                setStartDate(startDate);\n                setEndDate(endDate);\n              }}\n              bookedDates={props.bookedDates}\n            />\n            {dateChosen && (\n              <div>\n                <h2>Price per night</h2>\n                <p>${props.house.price}</p>\n                <h2>Total price for booking</h2>\n                <p>\n                  ${(numberOfNightsBetweenDates * props.house.price).toFixed(2)}\n                </p>\n\n                {user ? (\n                  <button\n                    className='reserve'\n                    onClick={async () => {\n                      if (\n                        !(await canReserve(props.house.id, startDate, endDate))\n                      ) {\n                        alert('The dates chosen are not valid');\n                        return;\n                      }\n                      try {\n                        const response = await axios.post(\n                          '/api/houses/reserve',\n                          {\n                            houseId: props.house.id,\n                            startDate,\n                            endDate\n                          }\n                        );\n                        if (response.data.status === 'error') {\n                          alert(response.data.message);\n                          return;\n                        }\n                        console.log(response.data);\n                      } catch (error) {\n                        console.log(error);\n                        return;\n                      }\n                    }}>\n                    Reserve\n                  </button>\n                ) : (\n                  <button\n                    className='reserve'\n                    onClick={() => {\n                      setShowLoginModal();\n                    }}>\n                    Reserve\n                  </button>\n                )}\n              </div>\n            )}\n          </aside>\n          <style jsx>{`\n            .container {\n              display: grid;\n              grid-template-columns: 60% 40%;\n              grid-gap: 30px;\n            }\n\n            aside {\n              border: 1px solid #ccc;\n              padding: 20px;\n            }\n          `}</style>\n        </div>\n      }\n    />\n  );\n};\n\nHouse.getInitialProps = async ({ query }) => {\n  const { id } = query;\n\n  const res = await fetch(`http://localhost:3000/api/houses/${id}`);\n  const house = await res.json();\n\n  const bookedDates = await getBookedDates(id);\n  return {\n    house,\n    bookedDates\n  };\n};\n\nexport default House;\n"]},"metadata":{},"sourceType":"module"}