{"ast":null,"code":"import _JSXStyle from \"styled-jsx/style\";\nimport React from \"react\";\nvar __jsx = React.createElement;\nimport fetch from 'isomorphic-unfetch';\nimport axios from 'axios';\nimport { useState } from 'react';\nimport { useStoreActions, useStoreState } from 'easy-peasy';\nimport Head from 'next/head';\nimport Layout from '../../components/Layout';\nimport DateRangePicker from '../../components/DateRangePicker';\n\nconst calcNumberOfNightsBetweenDates = (startDate, endDate) => {\n  const start = new Date(startDate);\n  const end = new Date(endDate);\n  let dayCount = 0;\n\n  while (end > start) {\n    dayCount++;\n    start.setDate(start.getDate() + 1);\n  }\n\n  return dayCount;\n};\n\nconst getBookedDates = async houseId => {\n  try {\n    const response = await axios.post('http://localhost:3000/api/houses/booked', {\n      houseId\n    });\n\n    if (response.data.status === 'error') {\n      alert(response.data.message);\n      return;\n    }\n\n    return response.data.dates;\n  } catch (error) {\n    console.error(error);\n    return;\n  }\n};\n\nconst canReserve = async (houseId, startDate, endDate) => {\n  try {\n    const response = await axios.post('http://localhost:3000/api/houses/check', {\n      houseId,\n      startDate,\n      endDate\n    });\n\n    if (response.data.status === 'error') {\n      alert(response.data.message);\n      return;\n    }\n\n    if (response.data.message === 'busy') {\n      return false;\n    }\n\n    return true;\n  } catch (error) {\n    console.error(error);\n    return;\n  }\n};\n\nconst House = props => {\n  const {\n    0: numberOfNightsBetweenDates,\n    1: setNumberOfNightsBetweenDates\n  } = useState(0);\n  const {\n    0: dateChosen,\n    1: setDateChosen\n  } = useState(false);\n  const {\n    0: startDate,\n    1: setStartDate\n  } = useState();\n  const {\n    0: endDate,\n    1: setEndDate\n  } = useState();\n  const setShowLoginModal = useStoreActions(actions => actions.modals.setShowLoginModal);\n  const user = useStoreState(state => state.user.user);\n  return __jsx(Layout, {\n    content: __jsx(\"div\", {\n      className: \"jsx-1671841858\" + \" \" + 'container'\n    }, __jsx(Head, null, __jsx(\"title\", {\n      className: \"jsx-1671841858\"\n    }, props.house.title)), __jsx(\"article\", {\n      className: \"jsx-1671841858\"\n    }, __jsx(\"h1\", {\n      className: \"jsx-1671841858\"\n    }, \"Welcome to \", props.house.hostName || 'no name', \"'s listing\"), __jsx(\"img\", {\n      src: props.house.picture,\n      width: \"100%\",\n      alt: \"House picture\",\n      className: \"jsx-1671841858\"\n    }), __jsx(\"p\", {\n      className: \"jsx-1671841858\"\n    }, props.house.type, \" - \", props.house.town), __jsx(\"div\", {\n      dangerouslySetInnerHTML: {\n        __html: props.house.description\n      },\n      className: \"jsx-1671841858\"\n    }), props.house.reviewsCount ? __jsx(\"div\", {\n      className: \"jsx-1671841858\" + \" \" + 'reviews'\n    }, __jsx(\"h3\", {\n      className: \"jsx-1671841858\"\n    }, props.house.reviewsCount, \" Reviews \"), props.house.reviews.map((review, index) => {\n      return __jsx(\"div\", {\n        key: index,\n        className: \"jsx-1671841858\"\n      }, __jsx(\"p\", {\n        className: \"jsx-1671841858\"\n      }, new Date(review.createdAt).toDateString()), __jsx(\"p\", {\n        className: \"jsx-1671841858\"\n      }, review.comment));\n    })) : __jsx(React.Fragment, null)), __jsx(\"aside\", {\n      className: \"jsx-1671841858\"\n    }, __jsx(\"h2\", {\n      className: \"jsx-1671841858\"\n    }, \"Add dates for prices\"), __jsx(DateRangePicker, {\n      datesChanged: (startDate, endDate) => {\n        setNumberOfNightsBetweenDates(calcNumberOfNightsBetweenDates(startDate, endDate));\n        setDateChosen(true);\n        setStartDate(startDate);\n        setEndDate(endDate);\n      },\n      bookedDates: props.bookedDates\n    }), dateChosen && __jsx(\"div\", {\n      className: \"jsx-1671841858\"\n    }, __jsx(\"h2\", {\n      className: \"jsx-1671841858\"\n    }, \"Price per night\"), __jsx(\"p\", {\n      className: \"jsx-1671841858\"\n    }, \"$\", props.house.price), __jsx(\"h2\", {\n      className: \"jsx-1671841858\"\n    }, \"Total price for booking\"), __jsx(\"p\", {\n      className: \"jsx-1671841858\"\n    }, \"$\", (numberOfNightsBetweenDates * props.house.price).toFixed(2)), user ? __jsx(\"button\", {\n      onClick: async () => {\n        if (!(await canReserve(props.house.id, startDate, endDate))) {\n          alert('The dates chosen are not valid');\n          return;\n        }\n\n        try {\n          const sessionResponse = await axios.post('/api/stripe/session', {\n            amount: props.house.price * numberOfNightsBetweenDates\n          });\n\n          if (sessionResponse.data.status === 'error') {\n            alert(sesssionResponse.data.message);\n            return;\n          }\n\n          const sessionId = sessionResponse.data.sessionId;\n          const stripePublicKey = sessionResponse.data.stripePublicKey;\n          const reserveResponse = await axios.post('/api/houses/reserve', {\n            houseId: props.house.id,\n            startDate,\n            endDate,\n            sessionId\n          });\n\n          if (sessionResponse.data.status === 'error') {\n            alert(sessionResponse.data.message);\n            return;\n          }\n\n          const stripe = Stripe(stripePublicKey);\n          const {\n            error\n          } = await stripe.redirectToCheckout({\n            sessionId\n          });\n          console.log(reserveResponse.data);\n        } catch (error) {\n          console.log(error);\n          return;\n        }\n      },\n      className: \"jsx-1671841858\" + \" \" + 'reserve'\n    }, \"Reserve\") : __jsx(\"button\", {\n      onClick: () => {\n        setShowLoginModal();\n      },\n      className: \"jsx-1671841858\" + \" \" + 'reserve'\n    }, \"Reserve\"))), __jsx(_JSXStyle, {\n      id: \"1671841858\"\n    }, \".container.jsx-1671841858{display:grid;grid-template-columns:60% 40%;grid-gap:30px;}aside.jsx-1671841858{border:1px solid #ccc;padding:20px;}\\n/*# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi9Vc2Vycy9iZW5ueXdhbmcvRG9jdW1lbnRzL1Byb2plY3RzL2dhbWVkbmQvcGFnZXMvaG91c2VzL1tpZF0uanMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IkFBd01zQixBQUc0QixBQU1TLGFBTFEsU0FNakIsYUFDZixRQU5nQixjQUNoQiIsImZpbGUiOiIvVXNlcnMvYmVubnl3YW5nL0RvY3VtZW50cy9Qcm9qZWN0cy9nYW1lZG5kL3BhZ2VzL2hvdXNlcy9baWRdLmpzIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IGZldGNoIGZyb20gJ2lzb21vcnBoaWMtdW5mZXRjaCc7XG5pbXBvcnQgYXhpb3MgZnJvbSAnYXhpb3MnO1xuaW1wb3J0IHsgdXNlU3RhdGUgfSBmcm9tICdyZWFjdCc7XG5pbXBvcnQgeyB1c2VTdG9yZUFjdGlvbnMsIHVzZVN0b3JlU3RhdGUgfSBmcm9tICdlYXN5LXBlYXN5JztcblxuaW1wb3J0IEhlYWQgZnJvbSAnbmV4dC9oZWFkJztcbmltcG9ydCBMYXlvdXQgZnJvbSAnLi4vLi4vY29tcG9uZW50cy9MYXlvdXQnO1xuaW1wb3J0IERhdGVSYW5nZVBpY2tlciBmcm9tICcuLi8uLi9jb21wb25lbnRzL0RhdGVSYW5nZVBpY2tlcic7XG5cbmNvbnN0IGNhbGNOdW1iZXJPZk5pZ2h0c0JldHdlZW5EYXRlcyA9IChzdGFydERhdGUsIGVuZERhdGUpID0+IHtcbiAgY29uc3Qgc3RhcnQgPSBuZXcgRGF0ZShzdGFydERhdGUpO1xuICBjb25zdCBlbmQgPSBuZXcgRGF0ZShlbmREYXRlKTtcbiAgbGV0IGRheUNvdW50ID0gMDtcblxuICB3aGlsZSAoZW5kID4gc3RhcnQpIHtcbiAgICBkYXlDb3VudCsrO1xuICAgIHN0YXJ0LnNldERhdGUoc3RhcnQuZ2V0RGF0ZSgpICsgMSk7XG4gIH1cbiAgcmV0dXJuIGRheUNvdW50O1xufTtcblxuY29uc3QgZ2V0Qm9va2VkRGF0ZXMgPSBhc3luYyBob3VzZUlkID0+IHtcbiAgdHJ5IHtcbiAgICBjb25zdCByZXNwb25zZSA9IGF3YWl0IGF4aW9zLnBvc3QoXG4gICAgICAnaHR0cDovL2xvY2FsaG9zdDozMDAwL2FwaS9ob3VzZXMvYm9va2VkJyxcbiAgICAgIHtcbiAgICAgICAgaG91c2VJZFxuICAgICAgfVxuICAgICk7XG4gICAgaWYgKHJlc3BvbnNlLmRhdGEuc3RhdHVzID09PSAnZXJyb3InKSB7XG4gICAgICBhbGVydChyZXNwb25zZS5kYXRhLm1lc3NhZ2UpO1xuICAgICAgcmV0dXJuO1xuICAgIH1cbiAgICByZXR1cm4gcmVzcG9uc2UuZGF0YS5kYXRlcztcbiAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICBjb25zb2xlLmVycm9yKGVycm9yKTtcbiAgICByZXR1cm47XG4gIH1cbn07XG5cbmNvbnN0IGNhblJlc2VydmUgPSBhc3luYyAoaG91c2VJZCwgc3RhcnREYXRlLCBlbmREYXRlKSA9PiB7XG4gIHRyeSB7XG4gICAgY29uc3QgcmVzcG9uc2UgPSBhd2FpdCBheGlvcy5wb3N0KFxuICAgICAgJ2h0dHA6Ly9sb2NhbGhvc3Q6MzAwMC9hcGkvaG91c2VzL2NoZWNrJyxcbiAgICAgIHtcbiAgICAgICAgaG91c2VJZCxcbiAgICAgICAgc3RhcnREYXRlLFxuICAgICAgICBlbmREYXRlXG4gICAgICB9XG4gICAgKTtcbiAgICBpZiAocmVzcG9uc2UuZGF0YS5zdGF0dXMgPT09ICdlcnJvcicpIHtcbiAgICAgIGFsZXJ0KHJlc3BvbnNlLmRhdGEubWVzc2FnZSk7XG4gICAgICByZXR1cm47XG4gICAgfVxuICAgIGlmIChyZXNwb25zZS5kYXRhLm1lc3NhZ2UgPT09ICdidXN5Jykge1xuICAgICAgcmV0dXJuIGZhbHNlO1xuICAgIH1cbiAgICByZXR1cm4gdHJ1ZTtcbiAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICBjb25zb2xlLmVycm9yKGVycm9yKTtcbiAgICByZXR1cm47XG4gIH1cbn07XG5cbmNvbnN0IEhvdXNlID0gcHJvcHMgPT4ge1xuICBjb25zdCBbbnVtYmVyT2ZOaWdodHNCZXR3ZWVuRGF0ZXMsIHNldE51bWJlck9mTmlnaHRzQmV0d2VlbkRhdGVzXSA9IHVzZVN0YXRlKFxuICAgIDBcbiAgKTtcbiAgY29uc3QgW2RhdGVDaG9zZW4sIHNldERhdGVDaG9zZW5dID0gdXNlU3RhdGUoZmFsc2UpO1xuICBjb25zdCBbc3RhcnREYXRlLCBzZXRTdGFydERhdGVdID0gdXNlU3RhdGUoKTtcbiAgY29uc3QgW2VuZERhdGUsIHNldEVuZERhdGVdID0gdXNlU3RhdGUoKTtcblxuICBjb25zdCBzZXRTaG93TG9naW5Nb2RhbCA9IHVzZVN0b3JlQWN0aW9ucyhcbiAgICBhY3Rpb25zID0+IGFjdGlvbnMubW9kYWxzLnNldFNob3dMb2dpbk1vZGFsXG4gICk7XG5cbiAgY29uc3QgdXNlciA9IHVzZVN0b3JlU3RhdGUoc3RhdGUgPT4gc3RhdGUudXNlci51c2VyKTtcblxuICByZXR1cm4gKFxuICAgIDxMYXlvdXRcbiAgICAgIGNvbnRlbnQ9e1xuICAgICAgICA8ZGl2IGNsYXNzTmFtZT0nY29udGFpbmVyJz5cbiAgICAgICAgICA8SGVhZD5cbiAgICAgICAgICAgIDx0aXRsZT57cHJvcHMuaG91c2UudGl0bGV9PC90aXRsZT5cbiAgICAgICAgICA8L0hlYWQ+XG4gICAgICAgICAgPGFydGljbGU+XG4gICAgICAgICAgICA8aDE+V2VsY29tZSB0byB7cHJvcHMuaG91c2UuaG9zdE5hbWUgfHwgJ25vIG5hbWUnfSdzIGxpc3Rpbmc8L2gxPlxuICAgICAgICAgICAgPGltZyBzcmM9e3Byb3BzLmhvdXNlLnBpY3R1cmV9IHdpZHRoPScxMDAlJyBhbHQ9J0hvdXNlIHBpY3R1cmUnIC8+XG4gICAgICAgICAgICA8cD5cbiAgICAgICAgICAgICAge3Byb3BzLmhvdXNlLnR5cGV9IC0ge3Byb3BzLmhvdXNlLnRvd259XG4gICAgICAgICAgICA8L3A+XG4gICAgICAgICAgICA8ZGl2XG4gICAgICAgICAgICAgIGRhbmdlcm91c2x5U2V0SW5uZXJIVE1MPXt7XG4gICAgICAgICAgICAgICAgX19odG1sOiBwcm9wcy5ob3VzZS5kZXNjcmlwdGlvblxuICAgICAgICAgICAgICB9fT48L2Rpdj5cbiAgICAgICAgICAgIHtwcm9wcy5ob3VzZS5yZXZpZXdzQ291bnQgPyAoXG4gICAgICAgICAgICAgIDxkaXYgY2xhc3NOYW1lPSdyZXZpZXdzJz5cbiAgICAgICAgICAgICAgICA8aDM+e3Byb3BzLmhvdXNlLnJldmlld3NDb3VudH0gUmV2aWV3cyA8L2gzPlxuXG4gICAgICAgICAgICAgICAge3Byb3BzLmhvdXNlLnJldmlld3MubWFwKChyZXZpZXcsIGluZGV4KSA9PiB7XG4gICAgICAgICAgICAgICAgICByZXR1cm4gKFxuICAgICAgICAgICAgICAgICAgICA8ZGl2IGtleT17aW5kZXh9PlxuICAgICAgICAgICAgICAgICAgICAgIDxwPntuZXcgRGF0ZShyZXZpZXcuY3JlYXRlZEF0KS50b0RhdGVTdHJpbmcoKX08L3A+XG4gICAgICAgICAgICAgICAgICAgICAgPHA+e3Jldmlldy5jb21tZW50fTwvcD5cbiAgICAgICAgICAgICAgICAgICAgPC9kaXY+XG4gICAgICAgICAgICAgICAgICApO1xuICAgICAgICAgICAgICAgIH0pfVxuICAgICAgICAgICAgICA8L2Rpdj5cbiAgICAgICAgICAgICkgOiAoXG4gICAgICAgICAgICAgIDw+PC8+XG4gICAgICAgICAgICApfVxuICAgICAgICAgIDwvYXJ0aWNsZT5cbiAgICAgICAgICA8YXNpZGU+XG4gICAgICAgICAgICA8aDI+QWRkIGRhdGVzIGZvciBwcmljZXM8L2gyPlxuICAgICAgICAgICAgPERhdGVSYW5nZVBpY2tlclxuICAgICAgICAgICAgICBkYXRlc0NoYW5nZWQ9eyhzdGFydERhdGUsIGVuZERhdGUpID0+IHtcbiAgICAgICAgICAgICAgICBzZXROdW1iZXJPZk5pZ2h0c0JldHdlZW5EYXRlcyhcbiAgICAgICAgICAgICAgICAgIGNhbGNOdW1iZXJPZk5pZ2h0c0JldHdlZW5EYXRlcyhzdGFydERhdGUsIGVuZERhdGUpXG4gICAgICAgICAgICAgICAgKTtcbiAgICAgICAgICAgICAgICBzZXREYXRlQ2hvc2VuKHRydWUpO1xuICAgICAgICAgICAgICAgIHNldFN0YXJ0RGF0ZShzdGFydERhdGUpO1xuICAgICAgICAgICAgICAgIHNldEVuZERhdGUoZW5kRGF0ZSk7XG4gICAgICAgICAgICAgIH19XG4gICAgICAgICAgICAgIGJvb2tlZERhdGVzPXtwcm9wcy5ib29rZWREYXRlc31cbiAgICAgICAgICAgIC8+XG4gICAgICAgICAgICB7ZGF0ZUNob3NlbiAmJiAoXG4gICAgICAgICAgICAgIDxkaXY+XG4gICAgICAgICAgICAgICAgPGgyPlByaWNlIHBlciBuaWdodDwvaDI+XG4gICAgICAgICAgICAgICAgPHA+JHtwcm9wcy5ob3VzZS5wcmljZX08L3A+XG4gICAgICAgICAgICAgICAgPGgyPlRvdGFsIHByaWNlIGZvciBib29raW5nPC9oMj5cbiAgICAgICAgICAgICAgICA8cD5cbiAgICAgICAgICAgICAgICAgICR7KG51bWJlck9mTmlnaHRzQmV0d2VlbkRhdGVzICogcHJvcHMuaG91c2UucHJpY2UpLnRvRml4ZWQoMil9XG4gICAgICAgICAgICAgICAgPC9wPlxuXG4gICAgICAgICAgICAgICAge3VzZXIgPyAoXG4gICAgICAgICAgICAgICAgICA8YnV0dG9uXG4gICAgICAgICAgICAgICAgICAgIGNsYXNzTmFtZT0ncmVzZXJ2ZSdcbiAgICAgICAgICAgICAgICAgICAgb25DbGljaz17YXN5bmMgKCkgPT4ge1xuICAgICAgICAgICAgICAgICAgICAgIGlmIChcbiAgICAgICAgICAgICAgICAgICAgICAgICEoYXdhaXQgY2FuUmVzZXJ2ZShwcm9wcy5ob3VzZS5pZCwgc3RhcnREYXRlLCBlbmREYXRlKSlcbiAgICAgICAgICAgICAgICAgICAgICApIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGFsZXJ0KCdUaGUgZGF0ZXMgY2hvc2VuIGFyZSBub3QgdmFsaWQnKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgICAgdHJ5IHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGNvbnN0IHNlc3Npb25SZXNwb25zZSA9IGF3YWl0IGF4aW9zLnBvc3QoXG4gICAgICAgICAgICAgICAgICAgICAgICAgICcvYXBpL3N0cmlwZS9zZXNzaW9uJyxcbiAgICAgICAgICAgICAgICAgICAgICAgICAge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGFtb3VudDpcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHByb3BzLmhvdXNlLnByaWNlICogbnVtYmVyT2ZOaWdodHNCZXR3ZWVuRGF0ZXNcbiAgICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICAgICAgKTtcblxuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHNlc3Npb25SZXNwb25zZS5kYXRhLnN0YXR1cyA9PT0gJ2Vycm9yJykge1xuICAgICAgICAgICAgICAgICAgICAgICAgICBhbGVydChzZXNzc2lvblJlc3BvbnNlLmRhdGEubWVzc2FnZSk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgICAgICAgICAgICAgY29uc3Qgc2Vzc2lvbklkID0gc2Vzc2lvblJlc3BvbnNlLmRhdGEuc2Vzc2lvbklkO1xuICAgICAgICAgICAgICAgICAgICAgICAgY29uc3Qgc3RyaXBlUHVibGljS2V5ID1cbiAgICAgICAgICAgICAgICAgICAgICAgICAgc2Vzc2lvblJlc3BvbnNlLmRhdGEuc3RyaXBlUHVibGljS2V5O1xuXG4gICAgICAgICAgICAgICAgICAgICAgICBjb25zdCByZXNlcnZlUmVzcG9uc2UgPSBhd2FpdCBheGlvcy5wb3N0KFxuICAgICAgICAgICAgICAgICAgICAgICAgICAnL2FwaS9ob3VzZXMvcmVzZXJ2ZScsXG4gICAgICAgICAgICAgICAgICAgICAgICAgIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBob3VzZUlkOiBwcm9wcy5ob3VzZS5pZCxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBzdGFydERhdGUsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgZW5kRGF0ZSxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBzZXNzaW9uSWRcbiAgICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICAgICAgKTtcblxuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHNlc3Npb25SZXNwb25zZS5kYXRhLnN0YXR1cyA9PT0gJ2Vycm9yJykge1xuICAgICAgICAgICAgICAgICAgICAgICAgICBhbGVydChzZXNzaW9uUmVzcG9uc2UuZGF0YS5tZXNzYWdlKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICAgICAgY29uc3Qgc3RyaXBlID0gU3RyaXBlKHN0cmlwZVB1YmxpY0tleSk7XG4gICAgICAgICAgICAgICAgICAgICAgICBjb25zdCB7IGVycm9yIH0gPSBhd2FpdCBzdHJpcGUucmVkaXJlY3RUb0NoZWNrb3V0KHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgc2Vzc2lvbklkXG4gICAgICAgICAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgICAgICAgICAgIGNvbnNvbGUubG9nKHJlc2VydmVSZXNwb25zZS5kYXRhKTtcbiAgICAgICAgICAgICAgICAgICAgICB9IGNhdGNoIChlcnJvcikge1xuICAgICAgICAgICAgICAgICAgICAgICAgY29uc29sZS5sb2coZXJyb3IpO1xuICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgfX0+XG4gICAgICAgICAgICAgICAgICAgIFJlc2VydmVcbiAgICAgICAgICAgICAgICAgIDwvYnV0dG9uPlxuICAgICAgICAgICAgICAgICkgOiAoXG4gICAgICAgICAgICAgICAgICA8YnV0dG9uXG4gICAgICAgICAgICAgICAgICAgIGNsYXNzTmFtZT0ncmVzZXJ2ZSdcbiAgICAgICAgICAgICAgICAgICAgb25DbGljaz17KCkgPT4ge1xuICAgICAgICAgICAgICAgICAgICAgIHNldFNob3dMb2dpbk1vZGFsKCk7XG4gICAgICAgICAgICAgICAgICAgIH19PlxuICAgICAgICAgICAgICAgICAgICBSZXNlcnZlXG4gICAgICAgICAgICAgICAgICA8L2J1dHRvbj5cbiAgICAgICAgICAgICAgICApfVxuICAgICAgICAgICAgICA8L2Rpdj5cbiAgICAgICAgICAgICl9XG4gICAgICAgICAgPC9hc2lkZT5cbiAgICAgICAgICA8c3R5bGUganN4PntgXG4gICAgICAgICAgICAuY29udGFpbmVyIHtcbiAgICAgICAgICAgICAgZGlzcGxheTogZ3JpZDtcbiAgICAgICAgICAgICAgZ3JpZC10ZW1wbGF0ZS1jb2x1bW5zOiA2MCUgNDAlO1xuICAgICAgICAgICAgICBncmlkLWdhcDogMzBweDtcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgYXNpZGUge1xuICAgICAgICAgICAgICBib3JkZXI6IDFweCBzb2xpZCAjY2NjO1xuICAgICAgICAgICAgICBwYWRkaW5nOiAyMHB4O1xuICAgICAgICAgICAgfVxuICAgICAgICAgIGB9PC9zdHlsZT5cbiAgICAgICAgPC9kaXY+XG4gICAgICB9XG4gICAgLz5cbiAgKTtcbn07XG5cbkhvdXNlLmdldEluaXRpYWxQcm9wcyA9IGFzeW5jICh7IHF1ZXJ5IH0pID0+IHtcbiAgY29uc3QgeyBpZCB9ID0gcXVlcnk7XG5cbiAgY29uc3QgcmVzID0gYXdhaXQgZmV0Y2goYGh0dHA6Ly9sb2NhbGhvc3Q6MzAwMC9hcGkvaG91c2VzLyR7aWR9YCk7XG4gIGNvbnN0IGhvdXNlID0gYXdhaXQgcmVzLmpzb24oKTtcblxuICBjb25zdCBib29rZWREYXRlcyA9IGF3YWl0IGdldEJvb2tlZERhdGVzKGlkKTtcblxuICByZXR1cm4ge1xuICAgIGhvdXNlLFxuICAgIGJvb2tlZERhdGVzXG4gIH07XG59O1xuXG5leHBvcnQgZGVmYXVsdCBIb3VzZTtcbiJdfQ== */\\n/*@ sourceURL=/Users/bennywang/Documents/Projects/gamednd/pages/houses/[id].js */\"))\n  });\n};\n\nHouse.getInitialProps = async ({\n  query\n}) => {\n  const {\n    id\n  } = query;\n  const res = await fetch(`http://localhost:3000/api/houses/${id}`);\n  const house = await res.json();\n  const bookedDates = await getBookedDates(id);\n  return {\n    house,\n    bookedDates\n  };\n};\n\nexport default House;","map":{"version":3,"sources":["/Users/bennywang/Documents/Projects/gamednd/pages/houses/[id].js"],"names":["fetch","axios","useState","useStoreActions","useStoreState","Head","Layout","DateRangePicker","calcNumberOfNightsBetweenDates","startDate","endDate","start","Date","end","dayCount","setDate","getDate","getBookedDates","houseId","response","post","data","status","alert","message","dates","error","console","canReserve","House","props","numberOfNightsBetweenDates","setNumberOfNightsBetweenDates","dateChosen","setDateChosen","setStartDate","setEndDate","setShowLoginModal","actions","modals","user","state","house","title","hostName","picture","type","town","__html","description","reviewsCount","reviews","map","review","index","createdAt","toDateString","comment","bookedDates","price","toFixed","id","sessionResponse","amount","sesssionResponse","sessionId","stripePublicKey","reserveResponse","stripe","Stripe","redirectToCheckout","log","getInitialProps","query","res","json"],"mappings":";;;AAAA,OAAOA,KAAP,MAAkB,oBAAlB;AACA,OAAOC,KAAP,MAAkB,OAAlB;AACA,SAASC,QAAT,QAAyB,OAAzB;AACA,SAASC,eAAT,EAA0BC,aAA1B,QAA+C,YAA/C;AAEA,OAAOC,IAAP,MAAiB,WAAjB;AACA,OAAOC,MAAP,MAAmB,yBAAnB;AACA,OAAOC,eAAP,MAA4B,kCAA5B;;AAEA,MAAMC,8BAA8B,GAAG,CAACC,SAAD,EAAYC,OAAZ,KAAwB;AAC7D,QAAMC,KAAK,GAAG,IAAIC,IAAJ,CAASH,SAAT,CAAd;AACA,QAAMI,GAAG,GAAG,IAAID,IAAJ,CAASF,OAAT,CAAZ;AACA,MAAII,QAAQ,GAAG,CAAf;;AAEA,SAAOD,GAAG,GAAGF,KAAb,EAAoB;AAClBG,IAAAA,QAAQ;AACRH,IAAAA,KAAK,CAACI,OAAN,CAAcJ,KAAK,CAACK,OAAN,KAAkB,CAAhC;AACD;;AACD,SAAOF,QAAP;AACD,CAVD;;AAYA,MAAMG,cAAc,GAAG,MAAMC,OAAN,IAAiB;AACtC,MAAI;AACF,UAAMC,QAAQ,GAAG,MAAMlB,KAAK,CAACmB,IAAN,CACrB,yCADqB,EAErB;AACEF,MAAAA;AADF,KAFqB,CAAvB;;AAMA,QAAIC,QAAQ,CAACE,IAAT,CAAcC,MAAd,KAAyB,OAA7B,EAAsC;AACpCC,MAAAA,KAAK,CAACJ,QAAQ,CAACE,IAAT,CAAcG,OAAf,CAAL;AACA;AACD;;AACD,WAAOL,QAAQ,CAACE,IAAT,CAAcI,KAArB;AACD,GAZD,CAYE,OAAOC,KAAP,EAAc;AACdC,IAAAA,OAAO,CAACD,KAAR,CAAcA,KAAd;AACA;AACD;AACF,CAjBD;;AAmBA,MAAME,UAAU,GAAG,OAAOV,OAAP,EAAgBT,SAAhB,EAA2BC,OAA3B,KAAuC;AACxD,MAAI;AACF,UAAMS,QAAQ,GAAG,MAAMlB,KAAK,CAACmB,IAAN,CACrB,wCADqB,EAErB;AACEF,MAAAA,OADF;AAEET,MAAAA,SAFF;AAGEC,MAAAA;AAHF,KAFqB,CAAvB;;AAQA,QAAIS,QAAQ,CAACE,IAAT,CAAcC,MAAd,KAAyB,OAA7B,EAAsC;AACpCC,MAAAA,KAAK,CAACJ,QAAQ,CAACE,IAAT,CAAcG,OAAf,CAAL;AACA;AACD;;AACD,QAAIL,QAAQ,CAACE,IAAT,CAAcG,OAAd,KAA0B,MAA9B,EAAsC;AACpC,aAAO,KAAP;AACD;;AACD,WAAO,IAAP;AACD,GAjBD,CAiBE,OAAOE,KAAP,EAAc;AACdC,IAAAA,OAAO,CAACD,KAAR,CAAcA,KAAd;AACA;AACD;AACF,CAtBD;;AAwBA,MAAMG,KAAK,GAAGC,KAAK,IAAI;AACrB,QAAM;AAAA,OAACC,0BAAD;AAAA,OAA6BC;AAA7B,MAA8D9B,QAAQ,CAC1E,CAD0E,CAA5E;AAGA,QAAM;AAAA,OAAC+B,UAAD;AAAA,OAAaC;AAAb,MAA8BhC,QAAQ,CAAC,KAAD,CAA5C;AACA,QAAM;AAAA,OAACO,SAAD;AAAA,OAAY0B;AAAZ,MAA4BjC,QAAQ,EAA1C;AACA,QAAM;AAAA,OAACQ,OAAD;AAAA,OAAU0B;AAAV,MAAwBlC,QAAQ,EAAtC;AAEA,QAAMmC,iBAAiB,GAAGlC,eAAe,CACvCmC,OAAO,IAAIA,OAAO,CAACC,MAAR,CAAeF,iBADa,CAAzC;AAIA,QAAMG,IAAI,GAAGpC,aAAa,CAACqC,KAAK,IAAIA,KAAK,CAACD,IAAN,CAAWA,IAArB,CAA1B;AAEA,SACE,MAAC,MAAD;AACE,IAAA,OAAO,EACL;AAAA,0CAAe;AAAf,OACE,MAAC,IAAD,QACE;AAAA;AAAA,OAAQV,KAAK,CAACY,KAAN,CAAYC,KAApB,CADF,CADF,EAIE;AAAA;AAAA,OACE;AAAA;AAAA,sBAAgBb,KAAK,CAACY,KAAN,CAAYE,QAAZ,IAAwB,SAAxC,eADF,EAEE;AAAK,MAAA,GAAG,EAAEd,KAAK,CAACY,KAAN,CAAYG,OAAtB;AAA+B,MAAA,KAAK,EAAC,MAArC;AAA4C,MAAA,GAAG,EAAC,eAAhD;AAAA;AAAA,MAFF,EAGE;AAAA;AAAA,OACGf,KAAK,CAACY,KAAN,CAAYI,IADf,SACwBhB,KAAK,CAACY,KAAN,CAAYK,IADpC,CAHF,EAME;AACE,MAAA,uBAAuB,EAAE;AACvBC,QAAAA,MAAM,EAAElB,KAAK,CAACY,KAAN,CAAYO;AADG,OAD3B;AAAA;AAAA,MANF,EAUGnB,KAAK,CAACY,KAAN,CAAYQ,YAAZ,GACC;AAAA,0CAAe;AAAf,OACE;AAAA;AAAA,OAAKpB,KAAK,CAACY,KAAN,CAAYQ,YAAjB,cADF,EAGGpB,KAAK,CAACY,KAAN,CAAYS,OAAZ,CAAoBC,GAApB,CAAwB,CAACC,MAAD,EAASC,KAAT,KAAmB;AAC1C,aACE;AAAK,QAAA,GAAG,EAAEA,KAAV;AAAA;AAAA,SACE;AAAA;AAAA,SAAI,IAAI1C,IAAJ,CAASyC,MAAM,CAACE,SAAhB,EAA2BC,YAA3B,EAAJ,CADF,EAEE;AAAA;AAAA,SAAIH,MAAM,CAACI,OAAX,CAFF,CADF;AAMD,KAPA,CAHH,CADD,GAcC,2BAxBJ,CAJF,EA+BE;AAAA;AAAA,OACE;AAAA;AAAA,8BADF,EAEE,MAAC,eAAD;AACE,MAAA,YAAY,EAAE,CAAChD,SAAD,EAAYC,OAAZ,KAAwB;AACpCsB,QAAAA,6BAA6B,CAC3BxB,8BAA8B,CAACC,SAAD,EAAYC,OAAZ,CADH,CAA7B;AAGAwB,QAAAA,aAAa,CAAC,IAAD,CAAb;AACAC,QAAAA,YAAY,CAAC1B,SAAD,CAAZ;AACA2B,QAAAA,UAAU,CAAC1B,OAAD,CAAV;AACD,OARH;AASE,MAAA,WAAW,EAAEoB,KAAK,CAAC4B;AATrB,MAFF,EAaGzB,UAAU,IACT;AAAA;AAAA,OACE;AAAA;AAAA,yBADF,EAEE;AAAA;AAAA,YAAKH,KAAK,CAACY,KAAN,CAAYiB,KAAjB,CAFF,EAGE;AAAA;AAAA,iCAHF,EAIE;AAAA;AAAA,YACI,CAAC5B,0BAA0B,GAAGD,KAAK,CAACY,KAAN,CAAYiB,KAA1C,EAAiDC,OAAjD,CAAyD,CAAzD,CADJ,CAJF,EAQGpB,IAAI,GACH;AAEE,MAAA,OAAO,EAAE,YAAY;AACnB,YACE,EAAE,MAAMZ,UAAU,CAACE,KAAK,CAACY,KAAN,CAAYmB,EAAb,EAAiBpD,SAAjB,EAA4BC,OAA5B,CAAlB,CADF,EAEE;AACAa,UAAAA,KAAK,CAAC,gCAAD,CAAL;AACA;AACD;;AACD,YAAI;AACF,gBAAMuC,eAAe,GAAG,MAAM7D,KAAK,CAACmB,IAAN,CAC5B,qBAD4B,EAE5B;AACE2C,YAAAA,MAAM,EACJjC,KAAK,CAACY,KAAN,CAAYiB,KAAZ,GAAoB5B;AAFxB,WAF4B,CAA9B;;AAQA,cAAI+B,eAAe,CAACzC,IAAhB,CAAqBC,MAArB,KAAgC,OAApC,EAA6C;AAC3CC,YAAAA,KAAK,CAACyC,gBAAgB,CAAC3C,IAAjB,CAAsBG,OAAvB,CAAL;AACA;AACD;;AAED,gBAAMyC,SAAS,GAAGH,eAAe,CAACzC,IAAhB,CAAqB4C,SAAvC;AACA,gBAAMC,eAAe,GACnBJ,eAAe,CAACzC,IAAhB,CAAqB6C,eADvB;AAGA,gBAAMC,eAAe,GAAG,MAAMlE,KAAK,CAACmB,IAAN,CAC5B,qBAD4B,EAE5B;AACEF,YAAAA,OAAO,EAAEY,KAAK,CAACY,KAAN,CAAYmB,EADvB;AAEEpD,YAAAA,SAFF;AAGEC,YAAAA,OAHF;AAIEuD,YAAAA;AAJF,WAF4B,CAA9B;;AAUA,cAAIH,eAAe,CAACzC,IAAhB,CAAqBC,MAArB,KAAgC,OAApC,EAA6C;AAC3CC,YAAAA,KAAK,CAACuC,eAAe,CAACzC,IAAhB,CAAqBG,OAAtB,CAAL;AACA;AACD;;AACD,gBAAM4C,MAAM,GAAGC,MAAM,CAACH,eAAD,CAArB;AACA,gBAAM;AAAExC,YAAAA;AAAF,cAAY,MAAM0C,MAAM,CAACE,kBAAP,CAA0B;AAChDL,YAAAA;AADgD,WAA1B,CAAxB;AAGAtC,UAAAA,OAAO,CAAC4C,GAAR,CAAYJ,eAAe,CAAC9C,IAA5B;AACD,SArCD,CAqCE,OAAOK,KAAP,EAAc;AACdC,UAAAA,OAAO,CAAC4C,GAAR,CAAY7C,KAAZ;AACA;AACD;AACF,OAlDH;AAAA,0CACY;AADZ,iBADG,GAuDH;AAEE,MAAA,OAAO,EAAE,MAAM;AACbW,QAAAA,iBAAiB;AAClB,OAJH;AAAA,0CACY;AADZ,iBA/DJ,CAdJ,CA/BF;AAAA;AAAA;AAFJ,IADF;AA0ID,CAxJD;;AA0JAR,KAAK,CAAC2C,eAAN,GAAwB,OAAO;AAAEC,EAAAA;AAAF,CAAP,KAAqB;AAC3C,QAAM;AAAEZ,IAAAA;AAAF,MAASY,KAAf;AAEA,QAAMC,GAAG,GAAG,MAAM1E,KAAK,CAAE,oCAAmC6D,EAAG,EAAxC,CAAvB;AACA,QAAMnB,KAAK,GAAG,MAAMgC,GAAG,CAACC,IAAJ,EAApB;AAEA,QAAMjB,WAAW,GAAG,MAAMzC,cAAc,CAAC4C,EAAD,CAAxC;AAEA,SAAO;AACLnB,IAAAA,KADK;AAELgB,IAAAA;AAFK,GAAP;AAID,CAZD;;AAcA,eAAe7B,KAAf","sourcesContent":["import fetch from 'isomorphic-unfetch';\nimport axios from 'axios';\nimport { useState } from 'react';\nimport { useStoreActions, useStoreState } from 'easy-peasy';\n\nimport Head from 'next/head';\nimport Layout from '../../components/Layout';\nimport DateRangePicker from '../../components/DateRangePicker';\n\nconst calcNumberOfNightsBetweenDates = (startDate, endDate) => {\n  const start = new Date(startDate);\n  const end = new Date(endDate);\n  let dayCount = 0;\n\n  while (end > start) {\n    dayCount++;\n    start.setDate(start.getDate() + 1);\n  }\n  return dayCount;\n};\n\nconst getBookedDates = async houseId => {\n  try {\n    const response = await axios.post(\n      'http://localhost:3000/api/houses/booked',\n      {\n        houseId\n      }\n    );\n    if (response.data.status === 'error') {\n      alert(response.data.message);\n      return;\n    }\n    return response.data.dates;\n  } catch (error) {\n    console.error(error);\n    return;\n  }\n};\n\nconst canReserve = async (houseId, startDate, endDate) => {\n  try {\n    const response = await axios.post(\n      'http://localhost:3000/api/houses/check',\n      {\n        houseId,\n        startDate,\n        endDate\n      }\n    );\n    if (response.data.status === 'error') {\n      alert(response.data.message);\n      return;\n    }\n    if (response.data.message === 'busy') {\n      return false;\n    }\n    return true;\n  } catch (error) {\n    console.error(error);\n    return;\n  }\n};\n\nconst House = props => {\n  const [numberOfNightsBetweenDates, setNumberOfNightsBetweenDates] = useState(\n    0\n  );\n  const [dateChosen, setDateChosen] = useState(false);\n  const [startDate, setStartDate] = useState();\n  const [endDate, setEndDate] = useState();\n\n  const setShowLoginModal = useStoreActions(\n    actions => actions.modals.setShowLoginModal\n  );\n\n  const user = useStoreState(state => state.user.user);\n\n  return (\n    <Layout\n      content={\n        <div className='container'>\n          <Head>\n            <title>{props.house.title}</title>\n          </Head>\n          <article>\n            <h1>Welcome to {props.house.hostName || 'no name'}'s listing</h1>\n            <img src={props.house.picture} width='100%' alt='House picture' />\n            <p>\n              {props.house.type} - {props.house.town}\n            </p>\n            <div\n              dangerouslySetInnerHTML={{\n                __html: props.house.description\n              }}></div>\n            {props.house.reviewsCount ? (\n              <div className='reviews'>\n                <h3>{props.house.reviewsCount} Reviews </h3>\n\n                {props.house.reviews.map((review, index) => {\n                  return (\n                    <div key={index}>\n                      <p>{new Date(review.createdAt).toDateString()}</p>\n                      <p>{review.comment}</p>\n                    </div>\n                  );\n                })}\n              </div>\n            ) : (\n              <></>\n            )}\n          </article>\n          <aside>\n            <h2>Add dates for prices</h2>\n            <DateRangePicker\n              datesChanged={(startDate, endDate) => {\n                setNumberOfNightsBetweenDates(\n                  calcNumberOfNightsBetweenDates(startDate, endDate)\n                );\n                setDateChosen(true);\n                setStartDate(startDate);\n                setEndDate(endDate);\n              }}\n              bookedDates={props.bookedDates}\n            />\n            {dateChosen && (\n              <div>\n                <h2>Price per night</h2>\n                <p>${props.house.price}</p>\n                <h2>Total price for booking</h2>\n                <p>\n                  ${(numberOfNightsBetweenDates * props.house.price).toFixed(2)}\n                </p>\n\n                {user ? (\n                  <button\n                    className='reserve'\n                    onClick={async () => {\n                      if (\n                        !(await canReserve(props.house.id, startDate, endDate))\n                      ) {\n                        alert('The dates chosen are not valid');\n                        return;\n                      }\n                      try {\n                        const sessionResponse = await axios.post(\n                          '/api/stripe/session',\n                          {\n                            amount:\n                              props.house.price * numberOfNightsBetweenDates\n                          }\n                        );\n\n                        if (sessionResponse.data.status === 'error') {\n                          alert(sesssionResponse.data.message);\n                          return;\n                        }\n\n                        const sessionId = sessionResponse.data.sessionId;\n                        const stripePublicKey =\n                          sessionResponse.data.stripePublicKey;\n\n                        const reserveResponse = await axios.post(\n                          '/api/houses/reserve',\n                          {\n                            houseId: props.house.id,\n                            startDate,\n                            endDate,\n                            sessionId\n                          }\n                        );\n\n                        if (sessionResponse.data.status === 'error') {\n                          alert(sessionResponse.data.message);\n                          return;\n                        }\n                        const stripe = Stripe(stripePublicKey);\n                        const { error } = await stripe.redirectToCheckout({\n                          sessionId\n                        });\n                        console.log(reserveResponse.data);\n                      } catch (error) {\n                        console.log(error);\n                        return;\n                      }\n                    }}>\n                    Reserve\n                  </button>\n                ) : (\n                  <button\n                    className='reserve'\n                    onClick={() => {\n                      setShowLoginModal();\n                    }}>\n                    Reserve\n                  </button>\n                )}\n              </div>\n            )}\n          </aside>\n          <style jsx>{`\n            .container {\n              display: grid;\n              grid-template-columns: 60% 40%;\n              grid-gap: 30px;\n            }\n\n            aside {\n              border: 1px solid #ccc;\n              padding: 20px;\n            }\n          `}</style>\n        </div>\n      }\n    />\n  );\n};\n\nHouse.getInitialProps = async ({ query }) => {\n  const { id } = query;\n\n  const res = await fetch(`http://localhost:3000/api/houses/${id}`);\n  const house = await res.json();\n\n  const bookedDates = await getBookedDates(id);\n\n  return {\n    house,\n    bookedDates\n  };\n};\n\nexport default House;\n"]},"metadata":{},"sourceType":"module"}